<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ ¸å¿ƒè¯æ±‡æ™ºèƒ½å¤ä¹  | VocabMaster V5</title>
    <!-- External CSS -->
    <link rel="stylesheet" href="styles/variables.css">
    <link rel="stylesheet" href="styles/base.css">
    <link rel="stylesheet" href="styles/layout.css">
    <link rel="stylesheet" href="styles/components.css">
    <link rel="stylesheet" href="styles/responsive.css">
</head>
<body>
<header>
    <div class="brand">
        <button class="btn-ghost" onclick="app.toggleFiles()" title="é€‰æ‹©æ–‡ä»¶">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 3h18v18H3z"></path>
                <path d="M9 3v18"></path>
                <path d="M3 9h18"></path>
            </svg>
        </button>
        <span id="currentFileDisplay" class="current-file-display"></span>
    </div>
    <div class="header-controls">
        <button class="btn-ghost" onclick="app.toggleShortcuts()" title="å¿«æ·é”®">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="9" y1="9" x2="9" y2="9"></line>
                <line x1="15" y1="9" x2="15" y2="9"></line>
                <line x1="9" y1="15" x2="15" y2="15"></line>
            </svg>
        </button>
        <div class="toggle-switch">
            <button id="btnModeInput" class="active" onclick="app.setMode('input')">æµè§ˆ</button>
            <button id="btnModeRecall" onclick="app.setMode('recall')">é®æŒ¡</button>
        </div>

        <button id="btnAutoPlay" class="btn-icon-toggle" onclick="app.toggleAutoPlay()" title="è‡ªåŠ¨æ’­æ”¾">
            <svg id="iconAutoPlayOff" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                 stroke-width="2">
                <polygon points="5 3 19 12 5 21 5 3"></polygon>
                <line x1="1" y1="1" x2="23" y2="23"></line>
            </svg>
            <svg id="iconAutoPlayOn" class="hidden" width="18" height="18" viewBox="0 0 24 24" fill="none"
                 stroke="currentColor" stroke-width="2">
                <polygon points="5 3 19 12 5 21 5 3"></polygon>
            </svg>
        </button>

        <button class="btn-ghost" onclick="app.toggleStats()">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="20" x2="18" y2="10"></line>
                <line x1="12" y1="20" x2="12" y2="4"></line>
                <line x1="6" y1="20" x2="6" y2="14"></line>
            </svg>
        </button>
    </div>
</header>
<aside id="filePanel">
    <div class="aside-header">
        <span>é€‰æ‹©æ–‡ä»¶</span>
        <div style="display: flex; gap: 0.5rem;">
            <button class="btn-ghost" onclick="app.refreshFileList()" title="åˆ·æ–°åˆ—è¡¨"
                    style="padding: 0.25rem 0.5rem; font-size: 0.8rem;">
                ğŸ”„
            </button>
            <button class="btn-ghost" onclick="app.toggleFiles()">âœ•</button>
        </div>
    </div>
    <div class="stats-list" id="fileListContainer">
        <div style="padding: 1rem; text-align: center; color: var(--secondary);">
            <div class="spinner" style="margin: 0 auto 1rem;"></div>
            åŠ è½½ä¸­...
        </div>
    </div>
</aside>

<aside id="statsPanel">
    <div class="aside-header">
        <span>å­¦ä¹ åˆ—è¡¨</span>
        <button class="btn-ghost" onclick="app.toggleStats()">âœ•</button>
    </div>
    <div class="stats-list" id="wordListContainer"></div>
    <div style="padding: 1rem; border-top: 1px solid #f1f5f9;">
        <button class="btn-danger" style="width: 100%; justify-content: center;" onclick="app.resetData()">é‡ç½®è¿›åº¦
        </button>
    </div>
</aside>
<main>
    <div id="loader" class="loader">
        <div class="spinner"></div>
        <p>æ­£åœ¨æ·±åº¦è§£æå¥å­ä¸ç”Ÿè¯...</p>
    </div>
    <div class="workspace">
        <article class="card hidden" id="cardContainer">
            <header class="card-header">
                <div class="word-title-group">
                    <span class="main-word" id="displayWord">Loading...</span>
                    <span class="pronunciation" id="displayPronunciation"></span>
                </div>
                <div class="badges" id="displayBadges"></div>
            </header>
            <div class="card-body">
                <ul class="item-list" id="itemList"></ul>
            </div>
            <footer class="card-footer">
                <button class="btn-ghost" onclick="app.prevCard()" id="btnPrev">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="15 18 9 12 15 6"></polyline>
                    </svg>
                    ä¸Šä¸€ä¸ª
                </button>
                <span class="progress-indicator" id="progressText">0 / 0</span>
                <div class="action-area" id="actionArea"></div>
            </footer>
        </article>
    </div>
</main>
<div id="toast" class="toast">Message</div>

<!-- Confirmation Dialog -->
<div id="confirmDialog" class="dialog-overlay">
    <div class="dialog">
        <div class="dialog-title">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="var(--primary)" stroke-width="2">
                <path d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
            </svg>
            <span>åˆ‡æ¢æ–‡ä»¶</span>
        </div>
        <div class="dialog-message" id="dialogMessage"></div>
        <div class="dialog-actions">
            <button class="btn-ghost" onclick="app.confirmDialog.cancel()">å–æ¶ˆ</button>
            <button class="btn-primary" id="dialogConfirmBtn">ç¡®å®š</button>
        </div>
    </div>
</div>

<!-- Shortcuts Dialog -->
<div id="shortcutsDialog" class="dialog-overlay">
    <div class="dialog">
        <div class="dialog-title">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="var(--primary)" stroke-width="2">
                <rect x="2" y="4" width="20" height="16" rx="2"></rect>
                <line x1="8" y1="2" x2="8" y2="6"></line>
                <line x1="16" y1="2" x2="16" y2="6"></line>
                <line x1="8" y1="12" x2="8" y2="12"></line>
                <line x1="12" y1="12" x2="12" y2="12"></line>
                <line x1="16" y1="12" x2="16" y2="12"></line>
            </svg>
            <span>é”®ç›˜å¿«æ·é”®</span>
        </div>
        <div class="dialog-message">
            <div class="shortcuts-list">
                <div class="shortcut-item">
                    <div class="shortcut-keys">
                        <kbd>Backspace</kbd>
                        <kbd>â†</kbd>
                    </div>
                    <span class="shortcut-desc">ä¸Šä¸€ä¸ª</span>
                </div>

                <div class="shortcut-item">
                    <div class="shortcut-keys">
                        <kbd>Enter</kbd>
                        <kbd>â†’</kbd>
                    </div>
                    <span class="shortcut-desc">ä¸‹ä¸€ä¸ª</span>
                </div>

                <div class="shortcut-item">
                    <div class="shortcut-keys">
                        <kbd>Space</kbd>
                    </div>
                    <span class="shortcut-desc">æ’­æ”¾å•è¯éŸ³é¢‘</span>
                </div>
                <div class="shortcut-item">
                    <div class="shortcut-keys">
                        <kbd>S</kbd>
                    </div>
                    <span class="shortcut-desc">æ’­æ”¾åŒä¹‰è¯éŸ³é¢‘</span>
                </div>
                <div class="shortcut-item">
                    <div class="shortcut-keys">
                        <kbd>A</kbd>
                    </div>
                    <span class="shortcut-desc">æ’­æ”¾åä¹‰è¯éŸ³é¢‘</span>
                </div>


                <div class="shortcut-item">
                    <div class="shortcut-keys">
                        <kbd>Esc</kbd>
                    </div>
                    <span class="shortcut-desc">å…³é—­å¼¹çª—</span>
                </div>
                <div class="shortcut-item">
                    <div class="shortcut-keys">
                        <kbd>Home</kbd>
                    </div>
                    <span class="shortcut-desc">ç¬¬ä¸€å¼ </span>
                </div>
                <div class="shortcut-item">
                    <div class="shortcut-keys">
                        <kbd>End</kbd>
                    </div>
                    <span class="shortcut-desc">æœ€åä¸€å¼ </span>
                </div>


                <div class="shortcut-item">
                    <div class="shortcut-keys">
                        <kbd>L</kbd>
                    </div>
                    <span class="shortcut-desc">å­¦ä¹ åˆ—è¡¨</span>
                </div>

                <div class="shortcut-item">
                    <div class="shortcut-keys">
                        <kbd>P</kbd>
                    </div>
                    <span class="shortcut-desc">è‡ªåŠ¨æ’­æ”¾å¼€å…³</span>
                </div>


                <div class="shortcut-item">
                    <div class="shortcut-keys">
                        <kbd>M</kbd>
                    </div>
                    <span class="shortcut-desc">åˆ‡æ¢æ¨¡å¼</span>
                </div>


                <div class="shortcut-item">
                    <div class="shortcut-keys">
                        <kbd>?</kbd>
                    </div>
                    <span class="shortcut-desc">å¿«æ·é”®å¸®åŠ©</span>
                </div>

                <div class="shortcut-item">
                    <div class="shortcut-keys">
                        <kbd>F</kbd>
                    </div>
                    <span class="shortcut-desc">é€‰æ‹©æ–‡ä»¶</span>
                </div>

            </div>
        </div>
        <div class="dialog-actions">
            <button class="btn-primary" onclick="app.toggleShortcuts()">å…³é—­</button>
        </div>
    </div>
</div>

<!-- Load VocabMaster App Module -->
<script type="module">
  import {VocabApp, CONFIG, STATE, GitHubApi, MarkdownParser} from './js/app/vocab-app.js';

  // Export to global scope for backward compatibility with inline event handlers
  window.CONFIG = CONFIG;
  window.STATE = STATE;
  window.GitHubApi = GitHubApi;
  window.MarkdownParser = MarkdownParser;

  // Create and initialize the app
  window.app = new VocabApp();

  // é”®ç›˜å¿«æ·é”®ç›‘å¬
  document.addEventListener('keydown', (e) => {
    // åªåœ¨æµè§ˆæ¨¡å¼ä¸‹å“åº”
    if (window.STATE.mode !== 'input') return;

    // å¦‚æœç„¦ç‚¹åœ¨è¾“å…¥æ¡†ä¸­ï¼Œä¸å“åº”å¿«æ·é”®
    if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;

    const currentCard = window.STATE.cards[window.STATE.currentIndex];
    if (!currentCard) return;

    // é˜²æŠ–ï¼šè®°å½•ä¸Šæ¬¡æ’­æ”¾æ—¶é—´ï¼ˆ500mså†…ä¸é‡å¤æ’­æ”¾ï¼‰
    const now = Date.now();
    if (!window._lastPlayTime) window._lastPlayTime = {};
    const debounceKey = e.key.toLowerCase();

    switch (e.key) {
      case 'Enter':
      case 'ArrowRight':
        e.preventDefault();
        window.app.nextCard();
        break;
      case 'Backspace':
      case 'ArrowLeft':
        e.preventDefault();
        window.app.prevCard();
        break;
      case ' ':
        e.preventDefault();
        // é˜²æŠ–æ£€æŸ¥
        if (window._lastPlayTime['space'] && now - window._lastPlayTime['space'] < 500) {
          return;
        }
        window._lastPlayTime['space'] = now;
        // æ ¹æ®å¡ç‰‡ç±»å‹ç¡®å®šæŒ‰é’®ID
        const playBtnId = currentCard.type === 'phrase' ? 'play-btn-phrase' : 'play-btn-main';
        window.app.playWord(currentCard.word, playBtnId, false, false);
        break;
      case 's':
      case 'S':
        e.preventDefault();
        // é˜²æŠ–æ£€æŸ¥
        if (window._lastPlayTime['s'] && now - window._lastPlayTime['s'] < 500) {
          return;
        }
        window._lastPlayTime['s'] = now;
        if (currentCard.synonyms && currentCard.synonyms.length > 0) {
          const synWord = currentCard.synonyms[0].word;
          const synBtnId = `play-btn-syn-${synWord.replace(/[^a-zA-Z0-9]/g, '-')}`;
          window.app.playWord(synWord, synBtnId, false, false);
        }
        break;
      case 'a':
      case 'A':
        e.preventDefault();
        // é˜²æŠ–æ£€æŸ¥
        if (window._lastPlayTime['a'] && now - window._lastPlayTime['a'] < 500) {
          return;
        }
        window._lastPlayTime['a'] = now;
        if (currentCard.antonyms && currentCard.antonyms.length > 0) {
          const antWord = currentCard.antonyms[0].word;
          const antBtnId = `play-btn-ant-${antWord.replace(/[^a-zA-Z0-9]/g, '-')}`;
          window.app.playWord(antWord, antBtnId, false, false);
        }
        break;
      case 'Escape':
        e.preventDefault();
        // ä¼˜å…ˆçº§ï¼šå¿«æ·é”®å¼¹çª— > æ–‡ä»¶é¢æ¿ > å­¦ä¹ åˆ—è¡¨
        const shortcutsDialog = document.getElementById('shortcutsDialog');
        if (shortcutsDialog.classList.contains('show')) {
          window.app.toggleShortcuts();
          return;
        }
        if (document.getElementById('filePanel').classList.contains('open')) {
          window.app.toggleFiles();
          return;
        }
        if (document.getElementById('statsPanel').classList.contains('open')) {
          window.app.toggleStats();
          return;
        }
        break;
      case '?':
        e.preventDefault();
        window.app.toggleShortcuts();
        break;
      case 'm':
      case 'M':
        e.preventDefault();
        const newMode = window.STATE.mode === 'input' ? 'recall' : 'input';
        window.app.setMode(newMode);
        break;
      case 'p':
      case 'P':
        e.preventDefault();
        window.app.toggleAutoPlay();
        break;
      case 'l':
      case 'L':
        e.preventDefault();
        window.app.toggleStats();
        break;
      case 'f':
      case 'F':
        e.preventDefault();
        window.app.toggleFiles();
        break;
      case 'Home':
        e.preventDefault();
        if (window.STATE.currentIndex !== 0) {
          window.STATE.currentIndex = 0;
          window.STATE.saveState();
          window.app.render();
          window.app.updateStatsUI();
          window.app.showToast('å·²è·³è½¬åˆ°ç¬¬ä¸€å¼ ');
        }
        break;
      case 'End':
        e.preventDefault();
        const lastIndex = window.STATE.cards.length - 1;
        if (window.STATE.currentIndex !== lastIndex) {
          window.STATE.currentIndex = lastIndex;
          window.STATE.saveState();
          window.app.render();
          window.app.updateStatsUI();
          window.app.showToast('å·²è·³è½¬åˆ°æœ€åä¸€å¼ ');
        }
        break;
    }
  });
</script>
</html>
